FROM tiangolo/uvicorn-gunicorn-fastapi:python3.9

WORKDIR /opt/app
ENV PIP_NO_CACHE_DIR=off \
    PIP_DISABLE_PIP_VERSION_CHECK=on \
    PIP_DEFAULT_TIMEOUT=100 \
    POETRY_NO_INTERACTION=1 \
    POETRY_VIRTUALENVS_CREATE=0 \
    PYTHONUNBUFFERED=1 \
    PYTHONPATH=/opt/app \
    PATH="${PATH}:/root/.local/bin" \
    PORT=8000

RUN apt update && apt install -y curl

# Copy using poetry.lock* in case it doesn't exist yet
COPY ./pyproject.toml ./poetry.lock* /app/
RUN curl -sSL https://install.python-poetry.org | python3 -
RUN RUN poetry install --no-ansi

COPY . .
